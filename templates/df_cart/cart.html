{% extends 'base.html' %}
{% block head %}
    <script type="text/javascript">
    $(function () {

        $('.add').click(function () {
            var t = $(this).parent().find('.num_show');
            var num = parseFloat(t.val());
            t.val(num+1);
            t.parent().parent().next().html((parseFloat(t.val())*parseFloat(t.parent().parent().prev().text())).toFixed(2));
            {#$('.col07').html(parseInt($('.cart_list_td .col05').text())*parseInt($num1)+"元");#}
            {#cal();#}
        });

        $('.minus').click(function () {
            var t = $(this).parent().find('.num_show');
            var num = parseFloat(t.val());
            if(num>1)
                t.val(num-1);
            t.parent().parent().next().html((parseFloat(t.val())*parseFloat(t.parent().parent().prev().text())).toFixed(2));
            {#cal()#}
        });
        $('.num_show').blur(function () {
           if($(this).val()<1)
               $(this).val(1);
        });
        cal();
        function cal() {
            for(var i=1;i<={{ carts.count }};i++ )
            {
                price = parseFloat($('#'+i).find('.col05').text());
                num = parseFloat($('#'+i).find('.num_add').find('.num_show').val());
                total = num*price;
                $('#'+i).find('.col07').html(total.toFixed(2));
            }

        }
    })
    </script>
{% endblock head%}
{% block content %}
	<div class="total_count">全部商品<em>2</em>件</div>	
	<ul class="cart_list_th clearfix">
		<li class="col01">商品名称</li>
		<li class="col02">商品单位</li>
		<li class="col03">商品价格</li>
		<li class="col04">数量</li>
		<li class="col05">小计</li>
		<li class="col06">操作</li>
	</ul>
{% for cart in carts %}
	<ul class="cart_list_td clearfix" id="{{ forloop.counter }}">

		<li class="col01"><input type="checkbox" name="" checked></li>
		<li class="col02"><img src="/static/{{ cart.goods.gpic }}"></li>
		<li class="col03">{{ cart.goods.gtitle }}<br><em>{{ cart.goods.gprice }}/{{ cart.goods.gunit }}</em></li>
		<li class="col04">{{ cart.goods.gunit }}</li>
		<li class="col05">{{ cart.goods.gprice }}</li>
		<li class="col06">
			<div class="num_add">
				<a href="javascript:;" class="add fl">+</a>
				<input type="text" class="num_show fl" value="{{ cart.count }}">
				<a href="javascript:;" class="minus fl">-</a>
			</div>
		</li>
		<li class="col07"></li>
		<li class="col08"><a href="javascript:;">删除</a></li>

	</ul>
{% endfor %}
	

	<ul class="settlements">
		<li class="col01"><input type="checkbox" name="" checked=""></li>
		<li class="col02">全选</li>
		<li class="col03">合计(不含运费)：<span>¥</span><em>42.60</em><br>共计<b>2</b>件商品</li>
		<li class="col04"><a href="place_order.html">去结算</a></li>
	</ul>
    <script type="text/javascript">
        $('.cart_list_td').each(function () {
            price = $(this).children().eq(5).text();
            num = $(this).children().eq(6).children().first().children().find($('.num_show').val());
            parseFloat(price)*parseFloat(num);
        });

    </script>
{% endblock content %}